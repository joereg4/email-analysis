/*
   Email Malware Detection Rules
   These are sample YARA rules for detecting malicious patterns in emails
*/

rule SuspiciousEmailHeaders {
    meta:
        description = "Detects suspicious email headers"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "medium"
    
    strings:
        $suspicious_header1 = "X-Originating-IP" ascii
        $suspicious_header2 = "X-Spam-Score" ascii
        $suspicious_header3 = "X-Mailer" ascii
        $suspicious_header4 = "Reply-To" ascii
        $suspicious_header5 = "Return-Path" ascii
    
    condition:
        3 of them
}

rule PhishingKeywords {
    meta:
        description = "Detects common phishing keywords"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "high"
    
    strings:
        $phishing1 = "verify your account" ascii nocase
        $phishing2 = "account suspended" ascii nocase
        $phishing3 = "click here to verify" ascii nocase
        $phishing4 = "urgent action required" ascii nocase
        $phishing5 = "security alert" ascii nocase
        $phishing6 = "account locked" ascii nocase
        $phishing7 = "verify your identity" ascii nocase
        $phishing8 = "confirm your details" ascii nocase
    
    condition:
        2 of them
}

rule FinancialScamKeywords {
    meta:
        description = "Detects financial scam keywords"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "high"
    
    strings:
        $scam1 = "lottery winner" ascii nocase
        $scam2 = "congratulations you won" ascii nocase
        $scam3 = "claim your prize" ascii nocase
        $scam4 = "inheritance" ascii nocase
        $scam5 = "unclaimed funds" ascii nocase
        $scam6 = "bank transfer" ascii nocase
        $scam7 = "wire transfer" ascii nocase
        $scam8 = "bitcoin" ascii nocase
        $scam9 = "cryptocurrency" ascii nocase
    
    condition:
        2 of them
}

rule MalwareDownloadKeywords {
    meta:
        description = "Detects malware download keywords"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "critical"
    
    strings:
        $malware1 = "download now" ascii nocase
        $malware2 = "click to download" ascii nocase
        $malware3 = "install software" ascii nocase
        $malware4 = "update your browser" ascii nocase
        $malware5 = "security update" ascii nocase
        $malware6 = "antivirus update" ascii nocase
        $malware7 = "flash player update" ascii nocase
        $malware8 = "java update" ascii nocase
    
    condition:
        2 of them
}

rule SuspiciousURLPatterns {
    meta:
        description = "Detects suspicious URL patterns"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "medium"
    
    strings:
        $url1 = "http://" ascii
        $url2 = "https://" ascii
        $url3 = "bit.ly/" ascii
        $url4 = "tinyurl.com/" ascii
        $url5 = "goo.gl/" ascii
        $url6 = "t.co/" ascii
        $url7 = "short.link/" ascii
    
    condition:
        ($url1 or $url2) and (2 of ($url3, $url4, $url5, $url6, $url7))
}

rule ExecutableAttachment {
    meta:
        description = "Detects executable attachments"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "critical"
    
    strings:
        $exe1 = ".exe" ascii
        $exe2 = ".msi" ascii
        $exe3 = ".bat" ascii
        $exe4 = ".cmd" ascii
        $exe5 = ".scr" ascii
        $exe6 = ".com" ascii
        $exe7 = ".pif" ascii
        $exe8 = ".jar" ascii
    
    condition:
        1 of them
}

rule ArchiveAttachment {
    meta:
        description = "Detects archive attachments"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "medium"
    
    strings:
        $archive1 = ".zip" ascii
        $archive2 = ".rar" ascii
        $archive3 = ".7z" ascii
        $archive4 = ".tar" ascii
        $archive5 = ".gz" ascii
        $archive6 = ".bz2" ascii
        $archive7 = ".xz" ascii
    
    condition:
        1 of them
}

rule UrgencyLanguage {
    meta:
        description = "Detects urgency language"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "low"
    
    strings:
        $urgency1 = "act now" ascii nocase
        $urgency2 = "limited time" ascii nocase
        $urgency3 = "expires soon" ascii nocase
        $urgency4 = "immediate action" ascii nocase
        $urgency5 = "urgent" ascii nocase
        $urgency6 = "asap" ascii nocase
        $urgency7 = "hurry" ascii nocase
        $urgency8 = "don't delay" ascii nocase
    
    condition:
        3 of them
}

rule AuthorityImpersonation {
    meta:
        description = "Detects authority impersonation"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "high"
    
    strings:
        $authority1 = "irs" ascii nocase
        $authority2 = "fbi" ascii nocase
        $authority3 = "cia" ascii nocase
        $authority4 = "police" ascii nocase
        $authority5 = "court" ascii nocase
        $authority6 = "legal notice" ascii nocase
        $authority7 = "government" ascii nocase
        $authority8 = "official" ascii nocase
        $authority9 = "authorized" ascii nocase
    
    condition:
        2 of them
}

rule SuspiciousEmailAddresses {
    meta:
        description = "Detects suspicious email address patterns"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "medium"
    
    strings:
        $email1 = "@" ascii
        $suspicious_domain1 = "gmail.com" ascii
        $suspicious_domain2 = "yahoo.com" ascii
        $suspicious_domain3 = "hotmail.com" ascii
        $suspicious_domain4 = "outlook.com" ascii
        $suspicious_domain5 = "aol.com" ascii
    
    condition:
        $email1 and (2 of ($suspicious_domain1, $suspicious_domain2, $suspicious_domain3, $suspicious_domain4, $suspicious_domain5))
}

rule Base64EncodedContent {
    meta:
        description = "Detects base64 encoded content"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "medium"
    
    strings:
        $base64_pattern = /[A-Za-z0-9+\/]{20,}={0,2}/
    
    condition:
        $base64_pattern
}

rule JavaScriptInEmail {
    meta:
        description = "Detects JavaScript in email content"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "high"
    
    strings:
        $js1 = "<script" ascii nocase
        $js2 = "javascript:" ascii nocase
        $js3 = "onclick=" ascii nocase
        $js4 = "onload=" ascii nocase
        $js5 = "onerror=" ascii nocase
        $js6 = "onmouseover=" ascii nocase
    
    condition:
        2 of them
}

rule SuspiciousFileExtensions {
    meta:
        description = "Detects suspicious file extensions"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "medium"
    
    strings:
        $ext1 = ".doc" ascii
        $ext2 = ".docx" ascii
        $ext3 = ".xls" ascii
        $ext4 = ".xlsx" ascii
        $ext5 = ".ppt" ascii
        $ext6 = ".pptx" ascii
        $ext7 = ".pdf" ascii
        $ext8 = ".txt" ascii
    
    condition:
        3 of them
}

rule SuspiciousContentLength {
    meta:
        description = "Detects suspicious content length"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "low"
    
    condition:
        filesize < 1000 or filesize > 1000000
}

rule SuspiciousMIME {
    meta:
        description = "Detects suspicious MIME types"
        author = "EmailAnalysisSandbox"
        date = "2024-01-01"
        severity = "medium"
    
    strings:
        $mime1 = "application/octet-stream" ascii
        $mime2 = "application/x-executable" ascii
        $mime3 = "application/x-msdownload" ascii
        $mime4 = "application/x-msdos-program" ascii
        $mime5 = "application/x-winexe" ascii
    
    condition:
        1 of them
}
